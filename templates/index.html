<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Management Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f3f4f6;
            display: flex;
        }

        .sidebar {
            width: 260px;
            background: #1f2937;
            color: white;
            height: 100vh;
            position: fixed;
            padding: 30px 20px;
        }

        .sidebar h1 {
            font-size: 24px;
            margin-bottom: 40px;
            color: #fff;
        }

        .nav-btn {
            width: 100%;
            padding: 15px 20px;
            background: transparent;
            border: none;
            color: white;
            text-align: left;
            cursor: pointer;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: #374151;
        }

        .nav-btn.active {
            background: #2563eb;
        }

        .main-content {
            margin-left: 260px;
            padding: 40px;
            width: calc(100% - 260px);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            color: #1f2937;
        }

        h2 {
            font-size: 28px;
            margin-bottom: 25px;
            color: #1f2937;
        }

        h3 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #1f2937;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        input,
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 15px;
            text-align: left;
            border-bottom: 3px solid #a7a7a7;
        }

        th {
            background: rgb(206, 226, 254);
            font-weight: 600;
            color: #0a0a0a;
        }

        tr{
            transition: all 0.3s ease
        }

        tr:hover {
            background: #d0d0d0;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .badge-paid {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-overdue {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-excellent {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-good {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-needs-improvement {
            background: #fee2e2;
            color: #991b1b;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 30px;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
        }

        .event-list {
            list-style: none;
        }

        .event-item {
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 13px;
        }


        /* succes message  */

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #16a34a;
            /* green */
            color: #fff;
            padding: 12px 18px;
            border-radius: 6px;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            z-index: 9999;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.error {
            background: #dc2626;
            /* red */
        }

        .toast.notify {
            background: #0022ff;
            /* red */
        }

        /* confirmation  */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .modal.show {
            display: flex;
        }

        .modal-box {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            width: 320px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-box h3 {
            margin-bottom: 8px;
        }

        .modal-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .modal-actions .btn {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .modal-actions .cancel {
            background: #e5e7eb;
        }

        .modal-actions .danger {
            background: #dc2626;
            color: white;
        }
    </style>
</head>

<body>
    <div id="toast" class="toast"></div>

    <div id="confirmModal" class="modal">
        <div class="modal-box">
            <h3>Confirm Deletion</h3>
            <p>This action cannot be undone.</p>
            <div class="modal-actions">
                <button onclick="closeConfirm()" class="btn cancel">Cancel</button>
                <button onclick="confirmDelete()" class="btn danger">Delete</button>
            </div>
        </div>
    </div>


    <div class="sidebar">
        <h1>School Admin</h1>
        <button class="nav-btn active" onclick="showPage('dashboard')">üìä Dashboard</button>
        <button class="nav-btn" onclick="showPage('students')">üë• Manage Students</button>
        <button class="nav-btn" onclick="showPage('fees')">üí∞ Fee Status</button>
        <button class="nav-btn" onclick="showPage('performance')">üìà Class Performance</button>
        <button class="nav-btn" onclick="showPage('teachers')">üë®‚Äçüè´ Manage Teachers</button>
        <button class="nav-btn" onclick="showPage('school')">üìÖ School Info</button>
    </div>

    <div class="main-content">
        <!-- Dashboard Page -->
        <div id="dashboard" class="page active">
            <h2>Dashboard Overview</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="number" id="totalStudents">0</div>
                    <h3>Total Students</h3>
                </div>
                <div class="stat-card">
                    <div class="number" id="totalTeachers">0</div>
                    <h3>Total Teachers</h3>
                </div>
                <div class="stat-card">
                    <div class="number" id="totalFees">$0</div>
                    <h3>Fee Collection</h3>
                </div>
            </div>
            <div class="chart-grid">
                <div class="card">
                    <h3>Fee Status Distribution</h3>
                    <div class="chart-container">
                        <canvas id="feeChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3>Recent Activities</h3>
                    <div class="event-list">
                        <div class="event-item">üìù New student enrolled</div>
                        <div class="event-item">üíµ Fee payment received</div>
                        <div class="event-item">üìÖ Event scheduled</div>
                        <div class="event-item">üë®‚Äçüè´ New teacher added</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Students Page -->
        <div id="students" class="page">
            <h2>Manage Students</h2>
            <div class="card" id="studentForm">
                <h3 id="addlabel">Add New Student</h3>
                <h3 id="updatelabel" style="display: none;">Update Student</h3>
                <div class="form-grid">
                    <label style="font-size:16px;">Name
                        <input type="text" id="studentName" placeholder="Student Name" style="margin:5px 0;">
                    </label>

                    <label style="font-size:16px;">Class
                        <select id="addstudentclass" required style="margin:5px 0;">
                            <option value="9">9</option>
                            <option value="10">10</option>
                        </select>
                    </label>

                    <label style="font-size:16px;">Section
                        <input type="text" id="section" placeholder="e.g., A" style="margin:5px 0;">
                    </label>

                    <label style="font-size:16px;">Roll Number
                        <input type="text" id="rollNumber" placeholder="e.g., A-123" style="margin:5px 0;">
                    </label>
                </div>

                <h3 style="font-size:18px;">Father/Guardian info</h3>

                <div class="form-grid">
                    <label style="font-size:16px;">Name
                        <input type="text" id="fatherName" placeholder="Full Name" style="margin:5px 0;">
                    </label>


                    <label style="font-size:16px;">Phone Number
                        <input type="text" id="phone" placeholder="e.g., 1234567890" style="margin:5px 0;">
                    </label>

                </div>

                <button class="btn btn-primary" style="background: green;"
                    onmouseover="this.style.background='darkgreen'" onmouseout="this.style.background='green'"
                    type="submit" id="addBtn" onclick="addStudent()">Add Student</button>

                <button class="btn btn-primary" id="updateBtn" style="display:none"
                    onclick="updateStudent(event)">Update Student</button>

                <button class="btn btn-primary" type="button" id="cancelBtn" style="display:none; background: #991b1b"
                    onclick="cancelUpdate()">
                    Cancel
                </button>
            </div>


            <div class="card" id="deletestudentscard">
                <h3>Delete a Student</h3>
                <div class="form-grid">

                    <h3 style="font-size: 16px;"> Class
                        <select style="margin: 5px 0;" name="status" id="deletestudentclass" required>

                            <option value="9">
                                9
                            </option>
                            <option value="10">
                                10
                            </option>
                        </select>
                    </h3>
                    <h3 style="font-size: 16px"> Section
                        <input style="margin: 5px 0;" type="text" id="Section" placeholder="e.g., A">
                    </h3>
                    <h3 style="font-size: 16px"> Roll Number
                        <input style="margin: 5px 0;" type="text" id="Rollnumber" placeholder="e.g., A-123">
                    </h3>
                </div>
                <button class="btn btn-primary" style="background-color: #991b1b;"
                    onmouseover="this.style.background='darkred'" onmouseout="this.style.background='#991b1b'"
                    onclick="openConfirm()">Delete
                    Student</button>
                <button class="btn btn-primary" type="button" id="canceldeleteBtn"
                    style="display:none; background: #0044d6" onclick="canceldelete()">
                    Cancel Delete
                </button>

            </div>


            <div class="card">
                <h3>Students List</h3>

                <div style="display:flex; gap:10px; align-items:center; margin-bottom:12px;">

                    <select style="width: 30%;" id="classfetchfilter">
                        <option value="9">Class 9</option>
                        <option value="10">Class 10</option>
                    </select>
                    <input style="margin: 5px 20px;" id="rollfetchfilter" placeholder="Roll num (Optional)">

                    <button onclick="fetchStudents()" class="btn btn-primary">
                        Refresh
                    </button>

                </div>

                <table id="studentTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Class</th>
                            <th>Section</th>
                            <th>Roll number</th>
                            <th>Father/Gaurdian</th>
                            <th>Phone</th>
                            <th style="display: flex; align-items: center; justify-content: center; ">Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Fees Page -->
        <div id="fees" class="page">
            <h2>Fee Status Management</h2>

            <div class="card">
                <h3>Add Record</h3>
                <div class="form-grid">
                    <h3 style="font-size: 16px;"">Name
                    <input style=" margin: 5px 0px;" type="text" id="studentNameforfee" placeholder="Student Name">
                    </h3>
                    <h3 style="font-size: 16px;"> Class
                        <select style="margin: 5px 0;" name="status" id="classforfee" required>

                            <option value="9">
                                9
                            </option>
                            <option value="10">
                                10
                            </option>
                        </select>
                    </h3>
                    <h3 style="font-size: 16px"> Section
                        <input style="margin: 5px 0;" type="text" id="Sectionforfee" placeholder="e.g., A">
                    </h3>
                    <h3 style="font-size: 16px"> Roll Number
                        <input style="margin: 5px 0;" type="text" id="Rollnumberforfee" placeholder="e.g., A-123">
                    </h3>
                    <h3 style="font-size: 16px"> Date
                        <input style="margin: 5px 0;" type="date" id="feedate" placeholder="MM/DD/YYYY">
                    </h3>
                    <h3 style="font-size: 16px;"> Month
                        <select style="margin: 5px 0;" id="feemonth" required>

                            <option value="january">
                                January
                            </option>
                            <option value="feburary">
                                Feburary
                            </option>
                            <option value="march">
                                March
                            </option>
                            <option value="april">
                                April
                            </option>
                            <option value="may">
                                May
                            </option>
                            <option value="june">
                                June
                            </option>
                            <option value="july">
                                July
                            </option>
                            <option value="august">
                                August
                            </option>
                            <option value="september">
                                September
                            </option>
                            <option value="october">
                                October
                            </option>
                            <option value="november">
                                November
                            </option>
                            <option value="december">
                                December
                            </option>
                        </select>
                    </h3>
                    <h3 style="font-size: 16px"> Amount
                        <input style="margin: 5px 0;" type="number" id="amount">
                    </h3>
                    <h3 style="font-size: 16px;"> Payment
                        <select style="margin: 5px 0;" id="paymentmethod" required>

                            <option value="cash">
                                Cash
                            </option>
                            <option value="online">
                                Online
                            </option>
                        </select>
                    </h3>
                </div>
                <button class="btn btn-primary" style="background-color: green;" onclick="addfee()">Add</button>

            </div>

            <div class="card" id="showfeetable" style="display: none;">
                <table id="feeTable">
                    <thead>
                        <tr>
                            <th>Student Name</th>
                            <th>Class</th>
                            <th>Amount</th>
                            <th>Current Status</th>
                            <th>Update Status</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Performance Page -->
        <div id="performance" class="page">
            <h2>Class Performance</h2>
            <div class="chart-grid">
                <div class="card">
                    <h3>Average Scores by Class</h3>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3>Student Count by Class</h3>
                    <div class="chart-container">
                        <canvas id="studentCountChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="card">
                <h3>Class Details</h3>
                <table id="performanceTable">
                    <thead>
                        <tr>
                            <th>Class</th>
                            <th>Average Score</th>
                            <th>Total Students</th>
                            <th>Performance</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Teachers Page -->
        <div id="teachers" class="page">
            <h2>Manage Teachers</h2>
            <div class="card">
                <h3>Add New Teacher</h3>
                <div class="form-grid">
                    <input type="text" id="teacherName" placeholder="Teacher Name">
                    <input type="text" id="teacherSubject" placeholder="Subject">
                    <input type="text" id="teacherClass" placeholder="Class">
                    <button class="btn btn-primary" onclick="addTeacher()">Add Teacher</button>
                </div>
            </div>
            <div class="card">
                <h3>Teacher List</h3>
                <table id="teacherTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Subject</th>
                            <th>Class</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>


        <!-- School Info Page -->
        <div id="school" class="page">
            <h2>School Information</h2>
            <div class="chart-grid">
                <div class="card">
                    <h3>‚è∞ School Timings</h3>
                    <input type="text" id="schoolTimings" value="8:00 AM - 2:00 PM">
                    <button class="btn btn-primary" style="margin-top: 15px;" onclick="updateTimings()">Update
                        Timings</button>
                </div>
                <div class="card">
                    <h3>üìÖ Add Event</h3>
                    <input type="text" id="eventInput" placeholder="Enter event">
                    <button class="btn btn-success" style="margin-top: 15px;" onclick="addEvent()">Add Event</button>
                </div>
            </div>
            <div class="chart-grid">
                <div class="card">
                    <h3>Upcoming Events</h3>
                    <ul class="event-list" id="eventList"></ul>
                </div>
                <div class="card">
                    <h3>Schedules</h3>
                    <ul class="event-list" id="scheduleList"></ul>
                </div>
            </div>
        </div>
    </div>

    <script>

        const select = document.getElementById("status");
        select.addEventListener("change", () => {
            concole.log("Selected:", select.value)
        })
    </script>



    <script>
        // Data storage

        // Page navigation
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            event.target.classList.add('active');

            if (pageId === 'dashboard') updateDashboard();
            if (pageId === 'performance') updatePerformanceCharts();
        }



        // -----------------------------------
        // Add students
        // -----------------------------------
        function addStudent() {
            event.preventDefault()
            const student = {
                name: document.getElementById("studentName").value.trim(),
                class_name: document.getElementById("addstudentclass").value,
                section: document.getElementById("section").value.trim(),
                roll_number: document.getElementById("rollNumber").value.trim(),
                father: document.getElementById("fatherName").value.trim(),
                phone: document.getElementById("phone").value.trim()
            };

            if (!student.name || !student.class_name || !student.section || !student.roll_number) {
                showToast("Please fill in the fields", "error");
                return;
            }

            const webhookUrl = "http://127.0.0.1:5000/students";

            fetch(webhookUrl, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(student)
            })
                .then(response => {
                    if (response.ok) {
                        showToast("Student added successfully!");

                        document.getElementById("studentName").value = "";
                        document.getElementById("addstudentclass").value = "Select class";
                        document.getElementById("section").value = "";
                        document.getElementById("rollNumber").value = "";
                        document.getElementById("fatherName").value = "";
                        document.getElementById("phone").value = "";
                    } else {
                        showToast("Student already exists", "error");
                    }
                })
                .catch(() => {
                    showToast("Server error", "error");
                });

        }



        // -----------------------------------
        // Delete student 
        // -----------------------------------

        let pendingDeleteData = null;

        function openConfirm() {
            const class_name = document.getElementById("deletestudentclass").value;
            const section = document.getElementById("Section").value.trim();
            const roll_number = document.getElementById("Rollnumber").value.trim();


            if (!class_name || !roll_number || !section) {
                showToast("Fill all fields first", "error");
                return;
            }



            pendingDeleteData = { "class": class_name, "rollNumber": roll_number };
            document.getElementById("confirmModal").classList.add("show");
        }

        function closeConfirm() {
            document.getElementById("confirmModal").classList.remove("show");
            pendingDeleteData = null;
        }

        function confirmDelete() {
            if (!pendingDeleteData) return;

            const webhookUrl = `http://127.0.0.1:5000/students/${pendingDeleteData.class}/${pendingDeleteData.rollNumber}`;
            ;

            fetch(webhookUrl, {
                method: "DELETE",
            })
                .then(res => {
                    if (res.ok) {
                        showToast("Student deleted successfully");
                        document.getElementById("deletestudentclass").value = "";
                        document.getElementById("Section").value = "";
                        document.getElementById("Rollnumber").value = "";
                    } else {
                        showToast("Student not found", "error");
                    }
                })
                .catch(() => showToast("Server error", "error"))
                .finally(closeConfirm);

            document.getElementById("canceldeleteBtn").style.display = "none";
            document.getElementById("deletestudentscard").style.border = "none";


        }

        // -----------------------------------
        // Render students 
        // -----------------------------------

        let editingStudentId = null;

        let students = [];


        async function fetchStudents() {
            const class_name = document.getElementById("classfetchfilter").value.trim();
            const roll_number = document.getElementById("rollfetchfilter").value.trim();

            if (roll_number === "") {
                url = `http://127.0.0.1:5000/students/${class_name}`
            }
            else {
                url = `http://127.0.0.1:5000/student/${class_name}/${roll_number}`
            }

            try {
                const res = await fetch(
                    url, {
                    method: "GET",
                }
                );

                students = await res.json();
                renderStudents();

            } catch (err) {
                showToast("Unable to retrieve data", "error");
            }
        }


        

        function renderStudents() {
            const tbody = document.querySelector("#studentTable tbody");
            tbody.innerHTML = "";

            if (!students || students.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5">No students found</td></tr>`;
                return;
            }

            students.forEach((s, index) => {
                const row = document.createElement("tr");
                const student_id = '${s.class_name}-${s.roll_number}';

                row.innerHTML = `<td>${s.name}</td>
                <td>${s.class_name}</td>
                <td>${s.section}</td>
            <td>${s["roll_number"]}</td>
            <td>${s["father"]}</td>
            <td>${s.parent_contact}</td>
            <td>
           <button type="button" class="btn btn-primary" onclick="startUpdate(${index})">Edit</button>
           <button type="button" class="btn btn-primary" style="background: red;" onclick="delete_students(${index})">Delete</button>
           </td>
            `;

                tbody.appendChild(row);
            });

        }
        // ------------------------------
        // delete student from list
        // ------------------------------ 


        function delete_students(index) {

            deletingIndex = index;
            const s = students[index];

            document.getElementById("deletestudentclass").value = s.class_name;
            document.getElementById("Section").value = s.section;
            document.getElementById("Rollnumber").value = s.roll_number;

            document.getElementById("canceldeleteBtn").style.display = "inline-block";
            document.getElementById("deletestudentscard").style.border = "3px solid green";

            document.getElementById("deletestudentscard").scrollIntoView({
                behavior: "smooth"
            });
        }


        // =----------------------------------
        // Update students 
        // -----------------------------------



        let editingIndex = null;

        // updating start button ---------

        function startUpdate(index) {

            editingIndex = index;
            const s = students[index];

            document.getElementById("studentName").value = s.name;
            document.getElementById("addstudentclass").value = s.class_name;
            document.getElementById("section").value = s.section;
            document.getElementById("rollNumber").value = s.roll_number;
            document.getElementById("fatherName").value = s.father;
            document.getElementById("phone").value = s.parent_contact;

            document.getElementById("addBtn").style.display = "none";
            document.getElementById("addlabel").style.display = "none";
            document.getElementById("updateBtn").style.display = "inline-block";
            document.getElementById("cancelBtn").style.display = "inline-block";
            document.getElementById("updatelabel").style.display = "inline-block";
            document.getElementById("studentForm").style.border = "3px solid green";


            document.getElementById("studentForm").scrollIntoView({
                behavior: "smooth"
            });
        }

        // main Update func ---------

        function updateStudent() {
            if (editingIndex === null) return;

            const original = students[editingIndex];

            const updated = {
                name: document.getElementById("studentName").value.trim(),
                class_name: document.getElementById("addstudentclass").value,
                section: document.getElementById("section").value.trim(),
                roll_number: document.getElementById("rollNumber").value.trim(),
                father: document.getElementById("fatherName").value.trim(),
                phone: document.getElementById("phone").value.trim()
            };

            const url = `http://127.0.0.1:5000/students/${original.class_name}/${original.roll_number}`;

            fetch(url, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(updated)
            })
                .then(res => {
                    if (res.status === 404) {
                        showToast("Student not found", "error");
                        return null;
                    }
                    if (!res.ok) {
                        showToast("Invalid update", "error");
                        return null;
                    }
                    return res.text(); // ‚Üê safe even if empty
                })
                .then(data => {
                    if (data === null) return;

                    showToast("Student updated");
                    resetFormState();
                    // fetchStudents();
                })
                .catch(err => {
                    console.error(err);
                    showToast("Server error", "error");
                });
        }

        function resetFormState() {
            editingIndex = null;

            document.getElementById("studentName").value = "";
            document.getElementById("addstudentclass").value = "";
            document.getElementById("section").value = "";
            document.getElementById("rollNumber").value = "";
            document.getElementById("fatherName").value = "";
            document.getElementById("phone").value = "";

            document.getElementById("updateBtn").style.display = "none";
            document.getElementById("cancelBtn").style.display = "none";
            document.getElementById("updatelabel").style.display = "none";
            document.getElementById("studentForm").style.border = "none";
            document.getElementById("addBtn").style.display = "inline-block";
            document.getElementById("addlabel").style.display = "inline-block";
        }


        // cancel button func-------

        function cancelUpdate() {

            editingIndex = null;

            document.getElementById("studentName").value = "";
            document.getElementById("addstudentclass").value = "";
            document.getElementById("section").value = "";
            document.getElementById("rollNumber").value = "";
            document.getElementById("fatherName").value = "";
            document.getElementById("phone").value = "";

            document.getElementById("updateBtn").style.display = "none";
            document.getElementById("cancelBtn").style.display = "none";
            document.getElementById("updatelabel").style.display = "none";
            document.getElementById("addBtn").style.display = "inline-block";
            document.getElementById("addlabel").style.display = "inline-block";
            document.getElementById("studentForm").style.border = "none";


            showToast("Update cancelled", "notify");
        }

        function canceldelete() {

            editingIndex = null;

            document.getElementById("deletestudentclass").value = "";
            document.getElementById("Section").value = "";
            document.getElementById("Rollnumber").value = "";

            document.getElementById("canceldeleteBtn").style.display = "none";
            document.getElementById("deletestudentscard").style.border = "none";


            showToast("Delete cancelled", "notify");
        }


        // ----------------------------------------
        // Fee submission
        // ----------------------------------------


                function addfee() {
                    const data = {
                        name: document.getElementById("studentNameforfee").value,
                        class_name: document.getElementById("classforfee").value,
                        section: document.getElementById("Sectionforfee").value,
                        roll_number: document.getElementById("Rollnumberforfee").value,
                        date: document.getElementById("feedate").value,
                        month: document.getElementById('feemonth').value,
                        amount: document.getElementById('amount').value,
                    };

                    if (!data.name || !data.roll_number || !data.class_name || !data.section || !data.month || !data.amount) {
                        showToast("Fill the fields first", "notify")
                        return;
                    }

                    fetch("http://127.0.0.1:5000/add-fee-payment", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(data)
                    })
                        
                .then(res => {
                    if (res.status === 404) {
                        showToast("Student not found", "error");
                        return null;
                    }
                    if (!res.ok) {
                        showToast("Invalid info", "error");
                        return null;
                    }
                    return res.text(); // ‚Üê safe even if empty
                })
                .then(data => {
                    if (data===null) return;
                    showToast("Record Added successfully");
                    reset_fee_form();
                    fetchfeedetails(data)
                })
                .catch(err => {
                    console.error(err);
                    showToast("Server error", "error");
                });
        }

        function reset_fee_form(){
            document.getElementById("studentNameforfee").value="";
            document.getElementById("classforfee").value="";
            document.getElementById("Sectionforfee").value="";
            document.getElementById("Rollnumberforfee").value="";
            document.getElementById("feedate").value="";
            document.getElementById("feemonth").value="";
            document.getElementById("amount").value="";
            document.getElementById("paymentmethod").value="";
        }


         let feedetails = [];


        async function fetchfeedetails(data) {
            const class_name = data.get("class_name");
            const roll_number = data.get("roll_number");
            const month = data.get("month")
            
            // if (roll_number === "") {
            //     url = `http://127.0.0.1:5000/students/${class_name}`
            // }
            // else {
            //     url = `http://127.0.0.1:5000/student/${class_name}/${roll_number}`
            // }

            // try {
            //     const res = await fetch(
            //         url, {
            //         method: "GET",
            //     }
            //     );

            //     students = await res.json();
            //     renderStudents();

            // } catch (err) {
            //     showToast("Unable to retrieve data", "error");
            // }
        }


        

        function renderStudents() {
            const tbody = document.querySelector("#studentTable tbody");
            tbody.innerHTML = "";

            if (!students || students.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5">No students found</td></tr>`;
                return;
            }

            students.forEach((s, index) => {
                const row = document.createElement("tr");
                const student_id = '${s.class_name}-${s.roll_number}';

                row.innerHTML = `<td>${s.name}</td>
                <td>${s.class_name}</td>
                <td>${s.section}</td>
            <td>${s["roll_number"]}</td>
            <td>${s["father"]}</td>
            <td>${s.parent_contact}</td>
            <td>
           <button type="button" class="btn btn-primary" onclick="startUpdate(${index})">Edit</button>
           <button type="button" class="btn btn-primary" style="background: red;" onclick="delete_students(${index})">Delete</button>
           </td>
            `;

                tbody.appendChild(row);
            });

        }

                


                // Dashboard functions
                // function updateDashboard() {
        //             document.getElementById('totalStudents').textContent = students.length;
        //             document.getElementById('totalTeachers').textContent = teachers.length;
        //             const totalFees = students.filter(s => s.feeStatus === 'Paid').reduce((acc, s) => acc + s.amount, 0);
        //             document.getElementById('totalFees').textContent = '$' + totalFees;

        //             updateFeeChart();
        //         }

        //         function updateFeeChart() {
        //             const paid = students.filter(s => s.feeStatus === 'Paid').length;
        //             const pending = students.filter(s => s.feeStatus === 'Pending').length;
        //             const overdue = students.filter(s => s.feeStatus === 'Overdue').length;

        //             if (feeChart) feeChart.destroy();

        //             const ctx = document.getElementById('feeChart').getContext('2d');
        //             feeChart = new Chart(ctx, {
        //                 type: 'pie',
        //                 data: {
        //                     labels: ['Paid', 'Pending', 'Overdue'],
        //                     datasets: [{
        //                         data: [paid, pending, overdue],
        //                         backgroundColor: ['#10b981', '#f59e0b', '#ef4444']
        //                     }]
        //                 },
        //                 options: {
        //                     responsive: true,
        //                     maintainAspectRatio: false
        //                 }
        //             });
        //         }

        //         function updatePerformanceCharts() {
        //             // Performance bar chart
        //             if (performanceChart) performanceChart.destroy();
        //             const ctx1 = document.getElementById('performanceChart').getContext('2d');
        //             performanceChart = new Chart(ctx1, {
        //                 type: 'bar',
        //                 data: {
        //                     labels: performanceData.map(p => p.class),
        //                     datasets: [{
        //                         label: 'Average Score',
        //                         data: performanceData.map(p => p.avgScore),
        //                         backgroundColor: '#3b82f6'
        //                     }]
        //                 },
        //                 options: {
        //                     responsive: true,
        //                     maintainAspectRatio: false,
        //                     scales: {
        //                         y: {
        //                             beginAtZero: true,
        //                             max: 100
        //                         }
        //                     }
        //                 }
        //             });

        //             // Student count line chart
        //             if (studentCountChart) studentCountChart.destroy();
        //             const ctx2 = document.getElementById('studentCountChart').getContext('2d');
        //             studentCountChart = new Chart(ctx2, {
        //                 type: 'line',
        //                 data: {
        //                     labels: performanceData.map(p => p.class),
        //                     datasets: [{
        //                         label: 'Students',
        //                         data: performanceData.map(p => p.students),
        //                         borderColor: '#10b981',
        //                         tension: 0.4
        //                     }]
        //                 },
        //                 options: {
        //                     responsive: true,
        //                     maintainAspectRatio: false
        //                 }
        //             });

        //             renderPerformanceTable();
        //         }



        // ------------------------------
        //    Toast message
        // ------------------------------
        function showToast(message, type = "success") {
            const toast = document.getElementById("toast");
            toast.textContent = message;

            toast.className = "toast show";
            if (type === "error") toast.classList.add("error");
            if (type === "notify") toast.classList.add("notify");

            setTimeout(() => {
                toast.className = "toast";
            }, 3000);
        }


        //         // Initialize
        //         // renderStudentTable();
        //         // renderFeeTable();
        //         // renderTeacherTable();
        //         // renderPerformanceTable();
        //         // renderEvents();
        //         // renderSchedules();
        //         // updateDashboard();
    </script>
</body>

</html>